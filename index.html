<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Zona De Desestr√©s</title>
    <!-- Carga Tailwind CSS para estilos modernos -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Carga Tone.js para el generador de ruido -->
    <script src="https://unpkg.com/tone@14.8.49/build/Tone.js"></script>
    <style>
        /* Estilos base y fuentes */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f9ff; /* Sky-50: Fondo muy claro y relajante */
            color: #1e293b; /* Slate-800: Texto oscuro */
        }
        .container-box {
            background-color: #ffffff;
            border-radius: 1.5rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            border: 1px solid #e0f2f7; /* Sky-100 */
        }
        .btn-desestres {
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(99, 102, 241, 0.2);
        }
        .btn-desestres:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(99, 102, 241, 0.4);
        }

        /* 1. Estilos para Burbujas (Bubble Popper) */
        #bubble-board {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 10px;
            padding: 20px;
            background: #e0f2f7; /* Sky-100 */
            border-radius: 1rem;
            max-height: 400px;
            overflow-y: scroll;
        }
        .bubble {
            width: 100%;
            padding-bottom: 100%; /* Truco para hacerlo cuadrado */
            background-color: #67e8f9; /* Cyan-400 */
            border-radius: 50%;
            cursor: pointer;
            position: relative;
            transform: scale(1);
            transition: transform 0.15s ease-out, opacity 0.3s ease-in-out;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2), inset 0 0 10px rgba(255,255,255,0.7);
        }
        .bubble:active {
            transform: scale(0.8);
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }
        .popped {
            opacity: 0;
            transform: scale(0);
        }
        
        /* 2. Estilos para Respiraci√≥n Guiada */
        #breathing-circle-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 300px;
            margin-bottom: 20px;
        }
        #breathing-circle {
            width: 150px;
            height: 150px;
            background-color: #818cf8; /* Indigo-400 */
            border-radius: 50%;
            box-shadow: 0 0 20px #818cf8;
            transition: all 4s ease-in-out;
            will-change: transform;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
            text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        }
        .breathe-in {
            transform: scale(1.5);
            transition-duration: 4s !important;
            box-shadow: 0 0 40px #6366f1;
        }
        .breathe-out {
            transform: scale(1);
            transition-duration: 8s !important;
            box-shadow: 0 0 20px #818cf8;
        }
        .hold-phase {
            transition-duration: 7s !important;
        }

        /* 3. Estilos para Lienzo Zen */
        #zen-canvas {
            touch-action: none; /* Previene el scroll con el dedo mientras se dibuja */
            border-radius: 0.75rem;
            border: 2px solid #cbd5e1; /* Slate-300 */
            background-color: white;
            cursor: crosshair;
        }

        /* Estilos para el Contador de Enfoque (Pomodoro) */
        #focus-timer {
            font-size: 4rem;
            font-weight: bold;
            color: #10b981; /* Emerald-500 */
        }
        .timer-running {
            box-shadow: 0 0 30px rgba(16, 185, 129, 0.5);
        }

        /* Estilos para Borrado de Preocupaciones */
        #worry-board {
            width: 100%;
            min-height: 200px;
            border: 1px dashed #94a3b8; /* Slate-400 */
            background-color: #f8fafc; /* Slate-50 */
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
            font-size: 1.1rem;
            color: #475569; /* Slate-600 */
        }
        .worry-item {
            display: inline-block;
            background-color: #fecaca; /* Red-200 */
            color: #991b1b; /* Red-800 */
            padding: 0.25rem 0.75rem;
            margin: 0.25rem;
            border-radius: 9999px;
            cursor: pointer;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .worry-item.erased {
            opacity: 0;
            transform: scale(0);
        }
        
        /* Estilos para Dibujo de Simetr√≠a */
        #symmetry-canvas {
            border-radius: 0.75rem;
            border: 2px solid #cbd5e1;
            background-color: white;
            cursor: crosshair;
        }


        /* Animaci√≥n de carga discreta */
        .loading-pulse {
            border-top-color: transparent;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div class="max-w-6xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-4xl sm:text-5xl font-extrabold text-indigo-600 mb-2">üßò La Zona De Desestr√©s üåä</h1>
            <p class="text-gray-600 text-lg">Un espacio para calmar la mente y liberar tensi√≥n con 10 actividades.</p>
        </header>

        <!-- Navegaci√≥n de Actividades (Tabs) -->
        <nav class="mb-8 border-b border-sky-200">
            <div id="activity-tabs" class="grid grid-cols-2 md:grid-cols-5 gap-2 sm:gap-4 -mb-px text-sm font-medium">
                <button data-activity="burbujas" class="px-2 py-2 text-indigo-600 border-b-2 border-indigo-500 active-tab transition duration-300 whitespace-nowrap overflow-hidden text-ellipsis">1. Pulsar Burbujas</button>
                <button data-activity="respiracion" class="px-2 py-2 text-gray-500 border-b-2 border-transparent hover:text-indigo-600 hover:border-indigo-300 transition duration-300 whitespace-nowrap overflow-hidden text-ellipsis">2. Respiraci√≥n Guiada</button>
                <button data-activity="lienzo" class="px-2 py-2 text-gray-500 border-b-2 border-transparent hover:text-indigo-600 hover:border-indigo-300 transition duration-300 whitespace-nowrap overflow-hidden text-ellipsis">3. Lienzo Zen</button>
                <button data-activity="ruido_blanco" class="px-2 py-2 text-gray-500 border-b-2 border-transparent hover:text-indigo-600 hover:border-indigo-300 transition duration-300 whitespace-nowrap overflow-hidden text-ellipsis">4. Ruido Blanco</button>
                <button data-activity="pomodoro" class="px-2 py-2 text-gray-500 border-b-2 border-transparent hover:text-indigo-600 hover:border-indigo-300 transition duration-300 whitespace-nowrap overflow-hidden text-ellipsis">5. Contador de Enfoque</button>
                <button data-activity="preocupaciones" class="px-2 py-2 text-gray-500 border-b-2 border-transparent hover:text-indigo-600 hover:border-indigo-300 transition duration-300 whitespace-nowrap overflow-hidden text-ellipsis">6. Borrado de Preocupaciones</button>
                <button data-activity="gratitud" class="px-2 py-2 text-gray-500 border-b-2 border-transparent hover:text-indigo-600 hover:border-indigo-300 transition duration-300 whitespace-nowrap overflow-hidden text-ellipsis">7. Diario de Gratitud</button>
                <button data-activity="ondas" class="px-2 py-2 text-gray-500 border-b-2 border-transparent hover:text-indigo-600 hover:border-indigo-300 transition duration-300 whitespace-nowrap overflow-hidden text-ellipsis">8. Visualizador de Ondas</button>
                <button data-activity="memoria" class="px-2 py-2 text-gray-500 border-b-2 border-transparent hover:text-indigo-600 hover:border-indigo-300 transition duration-300 whitespace-nowrap overflow-hidden text-ellipsis">9. Juego de Memoria</button>
                <button data-activity="simetria" class="px-2 py-2 text-gray-500 border-b-2 border-transparent hover:text-indigo-600 hover:border-indigo-300 transition duration-300 whitespace-nowrap overflow-hidden text-ellipsis">10. Dibujo de Simetr√≠a</button>
            </div>
        </nav>

        <!-- Contenedor de Actividades -->
        <div id="activity-container">
            <!-- Las actividades se cargar√°n aqu√≠ -->
        </div>
    </div>

    <!-- Script principal de JavaScript -->
    <script>
        // =======================================================
        // Configuraci√≥n Global y de UI
        // =======================================================
        const activityContainer = document.getElementById('activity-container');
        const activityTabs = document.getElementById('activity-tabs');
        
        let currentActivity = 'burbujas'; // La actividad inicial

        const activityTemplates = {
            'burbujas': renderBurbujas,
            'respiracion': renderRespiracion,
            'lienzo': renderLienzo,
            'ruido_blanco': renderRuidoBlanco,
            'pomodoro': renderPomodoro,
            'preocupaciones': renderPreocupaciones,
            'gratitud': renderGratitud,
            'ondas': renderOndas,
            'memoria': renderMemoria,
            'simetria': renderSimetria
        };

        function switchActivity(activityName) {
            // 1. Limpiar recursos de la actividad anterior
            cleanupPreviousActivity(currentActivity);

            currentActivity = activityName;
            activityContainer.innerHTML = activityTemplates[activityName]();
            
            // 2. Inicializar la l√≥gica de la nueva actividad
            if (activityName === 'burbujas') initializeBurbujas();
            if (activityName === 'respiracion') initializeRespiracion();
            if (activityName === 'lienzo') initializeLienzo();
            if (activityName === 'ruido_blanco') initializeRuidoBlanco();
            if (activityName === 'pomodoro') initializePomodoro();
            if (activityName === 'preocupaciones') initializePreocupaciones();
            if (activityName === 'gratitud') initializeGratitud();
            if (activityName === 'ondas') initializeOndas();
            if (activityName === 'memoria') initializeMemoria();
            if (activityName === 'simetria') initializeSimetria();

            // 3. Actualizar el estilo de las pesta√±as
            document.querySelectorAll('#activity-tabs button').forEach(button => {
                if (button.getAttribute('data-activity') === activityName) {
                    button.classList.remove('text-gray-500', 'border-transparent', 'hover:border-indigo-300');
                    button.classList.add('text-indigo-600', 'border-indigo-500');
                } else {
                    button.classList.add('text-gray-500', 'border-transparent', 'hover:border-indigo-300');
                    button.classList.remove('text-indigo-600', 'border-indigo-500');
                }
            });
        }

        // Manejar clics en las pesta√±as de navegaci√≥n
        activityTabs.addEventListener('click', (e) => {
            const activityName = e.target.closest('button')?.getAttribute('data-activity');
            if (activityName && activityName !== currentActivity) {
                switchActivity(activityName);
            }
        });

        // Funci√≥n para limpiar recursos de todas las actividades
        function cleanupPreviousActivity(activityName) {
            // Respiraci√≥n
            if (window.breathingInterval) {
                clearInterval(window.breathingInterval);
                window.breathingInterval = null;
            }
            // Ruido Blanco
            if (window.whiteNoise && window.whiteNoise.isStarted) {
                window.whiteNoise.dispose();
                window.whiteNoise = null;
                Tone.context.close();
            }
            // Pomodoro
            if (window.timerInterval) {
                clearInterval(window.timerInterval);
                window.timerInterval = null;
            }
            // Ondas
            if(window.waveAnimationFrame) {
                cancelAnimationFrame(window.waveAnimationFrame);
                window.waveAnimationFrame = null;
            }
        }

        // =======================================================
        // 1. PULSAR BURBUJAS (Bubble Popper)
        // =======================================================
        let burbujasState = {
            poppedCount: 0
        };
        const TOTAL_BUBBLES = 50; // Cantidad de burbujas en el tablero

        function renderBurbujas() {
            return `
                <div id="burbujas-activity" class="container-box max-w-2xl mx-auto text-center">
                    <h2 class="text-2xl font-bold mb-4 text-cyan-600">Pop It Digital</h2>
                    <p class="text-gray-500 mb-4">Pulsa todas las burbujas para liberar la tensi√≥n. Recarga cuando termines.</p>
                    
                    <div class="flex justify-between items-center mb-4 p-3 bg-sky-50 rounded-lg">
                        <div class="text-lg font-medium">Pulsadas: <span id="burbujas-count" class="text-cyan-600">${burbujasState.poppedCount}</span> / ${TOTAL_BUBBLES}</div>
                        <button id="burbujas-reset-button" class="btn-desestres bg-indigo-500 text-white font-bold py-2 px-4 rounded-xl hover:bg-indigo-600">
                            Recargar Tablero
                        </button>
                    </div>

                    <div id="bubble-board">
                        <!-- Las burbujas se inyectan aqu√≠ -->
                    </div>
                </div>
            `;
        }

        function initializeBurbujas() {
            const board = document.getElementById('bubble-board');
            if (!board) return;
            
            // Renderizar las burbujas
            board.innerHTML = '';
            for (let i = 0; i < TOTAL_BUBBLES; i++) {
                const bubble = document.createElement('div');
                bubble.classList.add('bubble');
                bubble.dataset.id = i;
                bubble.addEventListener('click', handleBubbleClick);
                board.appendChild(bubble);
            }

            // Reiniciar estado
            burbujasState.poppedCount = 0;
            document.getElementById('burbujas-count').textContent = burbujasState.poppedCount;
            document.getElementById('burbujas-reset-button').addEventListener('click', initializeBurbujas);
        }

        function handleBubbleClick(e) {
            const bubble = e.target;
            if (!bubble.classList.contains('popped')) {
                bubble.classList.add('popped');
                burbujasState.poppedCount++;
                document.getElementById('burbujas-count').textContent = burbujasState.poppedCount;
            }
        }

        // =======================================================
        // 2. RESPIRACI√ìN GUIADA (Breathing Guide)
        // =======================================================
        const BREATHING_PATTERN = [
            { text: "INHALA", duration: 4, action: 'in' }, // 4 segundos
            { text: "SOSTEN", duration: 7, action: 'hold' }, // 7 segundos
            { text: "EXHALA", duration: 8, action: 'out' }  // 8 segundos
        ];

        function renderRespiracion() {
            return `
                <div id="respiracion-activity" class="container-box max-w-xl mx-auto text-center">
                    <h2 class="text-2xl font-bold mb-4 text-indigo-600">Respiraci√≥n 4-7-8</h2>
                    <p class="text-gray-500 mb-6">Sigue el c√≠rculo para calmar tu sistema nervioso. Una ronda = 19 segundos.</p>
                    
                    <div id="breathing-circle-container">
                        <div id="breathing-circle">
                            <span id="breathing-text">LISTO</span>
                        </div>
                    </div>

                    <p id="breathing-info" class="text-lg font-semibold text-gray-700 mb-4">Patr√≥n: 4s INHALA - 7s SOSTEN - 8s EXHALA</p>

                    <button id="respiracion-start-button" class="btn-desestres bg-indigo-500 text-white font-bold py-3 px-6 rounded-xl hover:bg-indigo-600">
                        INICIAR CICLO
                    </button>
                </div>
            `;
        }
        
        function initializeRespiracion() {
            const startButton = document.getElementById('respiracion-start-button');
            const circle = document.getElementById('breathing-circle');
            const textElement = document.getElementById('breathing-text');

            startButton.addEventListener('click', () => startBreathingCycle(circle, textElement, startButton));
            
            // Limpiar cualquier ciclo anterior si se vuelve a la actividad
            cleanupPreviousActivity('respiracion'); 
        }

        function startBreathingCycle(circle, textElement, startButton) {
            if (window.breathingInterval) return; // Ya est√° corriendo

            startButton.disabled = true;
            let currentStepIndex = 0;

            // Empezar el ciclo completo
            textElement.textContent = "EMPEZANDO...";
            
            function runCycle() {
                let step = BREATHING_PATTERN[currentStepIndex];
                
                // Asegurar que la transici√≥n de CSS coincida con la duraci√≥n JS (importante para evitar saltos)
                circle.style.transitionDuration = `${step.duration}s`; 

                textElement.textContent = step.text;
                
                circle.classList.remove('breathe-in', 'breathe-out', 'hold-phase');

                if (step.action === 'in') {
                    circle.classList.add('breathe-in');
                } else if (step.action === 'out') {
                    circle.classList.add('breathe-out');
                } else if (step.action === 'hold') {
                    circle.classList.add('hold-phase');
                }
                
                currentStepIndex = (currentStepIndex + 1) % BREATHING_PATTERN.length;
                
                // Programar el siguiente paso
                window.breathingInterval = setTimeout(runCycle, step.duration * 1000);
            }
            
            setTimeout(() => {
                currentStepIndex = 0;
                runCycle();
            }, 1000); // 1 segundo de pausa

            // Esto es solo para que el usuario pueda parar el ciclo manualmente
            startButton.textContent = "DETENER CICLO";
            startButton.onclick = () => {
                clearTimeout(window.breathingInterval);
                window.breathingInterval = null;
                startButton.textContent = "INICIAR CICLO";
                startButton.disabled = false;
                circle.classList.remove('breathe-in', 'breathe-out', 'hold-phase');
                circle.style.transitionDuration = `0.5s`;
                textElement.textContent = "PAUSADO";
                circle.style.transform = 'scale(1)';
                startButton.onclick = () => startBreathingCycle(circle, textElement, startButton);
            };
        }


        // =======================================================
        // 3. LIENZO ZEN (Zen Canvas)
        // =======================================================
        let lienzoState = {
            isDrawing: false,
            lastX: 0,
            lastY: 0,
            color: '#1e293b', // Slate-800
            lineWidth: 5,
            canvas: null,
            ctx: null
        };

        function renderLienzo() {
            // Aseguramos que el lienzo ocupe el ancho completo y sea responsivo
            return `
                <div id="lienzo-activity" class="container-box max-w-4xl mx-auto text-center">
                    <h2 class="text-2xl font-bold mb-4 text-emerald-600">Lienzo para Garabatos Zen</h2>
                    <p class="text-gray-500 mb-4">Dibuja libremente. Deja que tu mano gu√≠e la l√≠nea y libera la mente.</p>
                    
                    <div class="flex flex-wrap justify-center gap-4 mb-4 p-3 bg-sky-50 rounded-lg">
                        <label class="text-sm font-medium text-gray-700 flex items-center">
                            Color: 
                            <input type="color" id="lienzo-color-picker" value="#1e293b" class="ml-2 w-8 h-8 rounded-full border-2 border-gray-400 cursor-pointer">
                        </label>
                        <label class="text-sm font-medium text-gray-700 flex items-center">
                            Grosor: 
                            <input type="range" id="lienzo-thickness-slider" min="1" max="20" value="5" class="ml-2 w-32 cursor-pointer">
                            <span id="lienzo-thickness-value" class="ml-2 text-gray-700">5</span>
                        </label>
                        <button id="lienzo-clear-button" class="btn-desestres bg-red-500 text-white font-bold py-2 px-4 rounded-xl hover:bg-red-600">
                            Limpiar
                        </button>
                    </div>

                    <canvas id="zen-canvas"></canvas>
                </div>
            `;
        }

        function initializeLienzo() {
            lienzoState.canvas = document.getElementById('zen-canvas');
            lienzoState.ctx = lienzoState.canvas.getContext('2d');

            // Hacer el canvas responsivo
            function resizeCanvas() {
                const container = document.getElementById('lienzo-activity');
                if (container) {
                    lienzoState.canvas.width = container.clientWidth - 32; // -32 por padding del container
                    lienzoState.canvas.height = Math.min(400, container.clientWidth * 0.75); // Altura m√°xima de 400px o 75% del ancho
                }
            }
            window.addEventListener('resize', resizeCanvas);
            resizeCanvas(); // Llamada inicial

            // Configuraci√≥n inicial del contexto
            lienzoState.ctx.lineCap = 'round';
            lienzoState.ctx.lineJoin = 'round';
            lienzoState.ctx.lineWidth = lienzoState.lineWidth;
            lienzoState.ctx.strokeStyle = lienzoState.color;

            // Event listeners para la interacci√≥n (Mouse y Touch)
            lienzoState.canvas.addEventListener('mousedown', startDrawingLienzo);
            lienzoState.canvas.addEventListener('mousemove', drawLienzo);
            lienzoState.canvas.addEventListener('mouseup', stopDrawingLienzo);
            lienzoState.canvas.addEventListener('mouseout', stopDrawingLienzo);
            
            lienzoState.canvas.addEventListener('touchstart', startDrawingLienzo);
            lienzoState.canvas.addEventListener('touchmove', drawLienzo);
            lienzoState.canvas.addEventListener('touchend', stopDrawingLienzo);

            // Controles
            document.getElementById('lienzo-color-picker').addEventListener('input', (e) => {
                lienzoState.color = e.target.value;
                lienzoState.ctx.strokeStyle = lienzoState.color;
            });
            const thicknessSlider = document.getElementById('lienzo-thickness-slider');
            const thicknessValue = document.getElementById('lienzo-thickness-value');
            thicknessSlider.addEventListener('input', (e) => {
                lienzoState.lineWidth = parseInt(e.target.value);
                lienzoState.ctx.lineWidth = lienzoState.lineWidth;
                thicknessValue.textContent = lienzoState.lineWidth;
            });
            document.getElementById('lienzo-clear-button').addEventListener('click', clearCanvasLienzo);
        }
        
        // Helper para obtener la posici√≥n correcta del evento (mouse o touch)
        function getCoordsLienzo(e) {
            const rect = lienzoState.canvas.getBoundingClientRect();
            let clientX, clientY;

            if (e.touches && e.touches.length > 0) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }

            return {
                x: clientX - rect.left,
                y: clientY - rect.top
            };
        }

        function startDrawingLienzo(e) {
            e.preventDefault(); // Previene el scroll o el comportamiento t√°ctil por defecto
            lienzoState.isDrawing = true;
            const coords = getCoordsLienzo(e);
            [lienzoState.lastX, lienzoState.lastY] = [coords.x, coords.y];
        }

        function drawLienzo(e) {
            e.preventDefault(); 
            if (!lienzoState.isDrawing) return;
            
            const coords = getCoordsLienzo(e);
            const ctx = lienzoState.ctx;

            ctx.beginPath();
            ctx.moveTo(lienzoState.lastX, lienzoState.lastY);
            ctx.lineTo(coords.x, coords.y);
            ctx.stroke();

            [lienzoState.lastX, lienzoState.lastY] = [coords.x, coords.y];
        }

        function stopDrawingLienzo() {
            lienzoState.isDrawing = false;
        }

        function clearCanvasLienzo() {
            const ctx = lienzoState.ctx;
            ctx.clearRect(0, 0, lienzoState.canvas.width, lienzoState.canvas.height);
        }
        
        // =======================================================
        // 4. GENERADOR DE RUIDO BLANCO (White Noise)
        // =======================================================
        let noiseState = {
            noiseType: 'white',
            volume: -10, // dB
            isPlaying: false
        };

        function renderRuidoBlanco() {
            return `
                <div id="ruido-blanco-activity" class="container-box max-w-xl mx-auto text-center">
                    <h2 class="text-2xl font-bold mb-4 text-pink-600">Generador de Sonido Relajante</h2>
                    <p class="text-gray-500 mb-6">Usa el ruido blanco/rosa/marr√≥n para bloquear distracciones y mejorar la concentraci√≥n.</p>
                    
                    <div class="flex justify-center gap-4 mb-6">
                        <button data-noise="white" class="noise-btn bg-white text-gray-800 border-2 border-pink-400 font-semibold py-2 px-4 rounded-xl hover:bg-pink-100 transition duration-200">Blanco</button>
                        <button data-noise="pink" class="noise-btn bg-white text-gray-800 border-2 border-pink-400 font-semibold py-2 px-4 rounded-xl hover:bg-pink-100 transition duration-200">Rosa</button>
                        <button data-noise="brown" class="noise-btn bg-white text-gray-800 border-2 border-pink-400 font-semibold py-2 px-4 rounded-xl hover:bg-pink-100 transition duration-200">Marr√≥n</button>
                    </div>

                    <div class="mb-6">
                        <label for="volume-slider" class="block text-sm font-medium text-gray-700 mb-2">Volumen:</label>
                        <input type="range" id="volume-slider" min="-30" max="0" value="-10" class="w-full cursor-pointer">
                    </div>

                    <button id="noise-toggle-button" class="btn-desestres bg-pink-500 text-white font-bold py-3 px-6 rounded-xl hover:bg-pink-600">
                        INICIAR SONIDO
                    </button>
                </div>
            `;
        }

        function initializeRuidoBlanco() {
            const toggleButton = document.getElementById('noise-toggle-button');
            const volumeSlider = document.getElementById('volume-slider');
            const noiseButtons = document.querySelectorAll('.noise-btn');

            // Set initial state for buttons
            noiseButtons.forEach(btn => {
                if (btn.dataset.noise === noiseState.noiseType) {
                    btn.classList.add('bg-pink-500', 'text-white');
                    btn.classList.remove('bg-white', 'text-gray-800');
                }
            });

            // Handlers
            toggleButton.addEventListener('click', toggleNoise);
            volumeSlider.addEventListener('input', setNoiseVolume);
            noiseButtons.forEach(btn => btn.addEventListener('click', changeNoiseType));
        }

        function toggleNoise() {
            if (noiseState.isPlaying) {
                // Stop noise
                window.whiteNoise.stop();
                window.whiteNoise.dispose();
                window.whiteNoise = null;
                Tone.context.close();
                noiseState.isPlaying = false;
                document.getElementById('noise-toggle-button').textContent = 'INICIAR SONIDO';
                document.getElementById('noise-toggle-button').classList.remove('bg-red-500', 'hover:bg-red-600');
                document.getElementById('noise-toggle-button').classList.add('bg-pink-500', 'hover:bg-pink-600');
            } else {
                // Start noise
                Tone.start().then(() => {
                    window.whiteNoise = new Tone.Noise(noiseState.noiseType).start();
                    const gain = new Tone.Gain().toDestination();
                    gain.gain.value = Tone.dbToGain(noiseState.volume);
                    window.whiteNoise.connect(gain);
                    noiseState.isPlaying = true;
                    document.getElementById('noise-toggle-button').textContent = 'DETENER SONIDO';
                    document.getElementById('noise-toggle-button').classList.remove('bg-pink-500', 'hover:bg-pink-600');
                    document.getElementById('noise-toggle-button').classList.add('bg-red-500', 'hover:bg-red-600');
                });
            }
        }

        function setNoiseVolume(e) {
            noiseState.volume = parseInt(e.target.value);
            if (noiseState.isPlaying && window.whiteNoise && window.whiteNoise.output) {
                // Adjust volume using the gain node connected to the whiteNoise output
                const gainNode = window.whiteNoise.output.output;
                if (gainNode) {
                    gainNode.gain.value = Tone.dbToGain(noiseState.volume);
                }
            }
        }

        function changeNoiseType(e) {
            const newType = e.target.dataset.noise;
            noiseState.noiseType = newType;

            document.querySelectorAll('.noise-btn').forEach(btn => {
                btn.classList.remove('bg-pink-500', 'text-white');
                btn.classList.add('bg-white', 'text-gray-800');
            });
            e.target.classList.add('bg-pink-500', 'text-white');
            e.target.classList.remove('bg-white', 'text-gray-800');

            if (noiseState.isPlaying) {
                window.whiteNoise.type = newType; // Change type on the fly
            }
        }

        // =======================================================
        // 5. CONTADOR DE ENFOQUE (Pomodoro Simple)
        // =======================================================
        let pomodoroState = {
            duration: 25 * 60, // 25 minutos en segundos
            remaining: 25 * 60,
            isRunning: false,
            isBreak: false,
            interval: null
        };

        function renderPomodoro() {
            const minutes = String(Math.floor(pomodoroState.remaining / 60)).padStart(2, '0');
            const seconds = String(pomodoroState.remaining % 60).padStart(2, '0');
            const status = pomodoroState.isBreak ? 'DESCANSANDO' : 'TRABAJO';

            return `
                <div id="pomodoro-activity" class="container-box max-w-sm mx-auto text-center">
                    <h2 class="text-2xl font-bold mb-4 text-teal-600">Contador de Enfoque</h2>
                    <p class="text-gray-500 mb-6">Trabaja 25 minutos, descansa 5. Enfoca tu energ√≠a.</p>
                    
                    <div id="focus-timer-status" class="text-xl font-medium mb-4 p-2 rounded-full ${pomodoroState.isBreak ? 'bg-orange-100 text-orange-600' : 'bg-teal-100 text-teal-600'}">
                        ${status}
                    </div>

                    <div id="focus-timer" class="p-6 rounded-2xl mb-6 ${pomodoroState.isRunning ? 'timer-running' : ''}">
                        ${minutes}:${seconds}
                    </div>

                    <div class="flex justify-center gap-4">
                        <button id="pomodoro-toggle-button" class="btn-desestres bg-teal-500 text-white font-bold py-3 px-6 rounded-xl hover:bg-teal-600">
                            ${pomodoroState.isRunning ? 'PAUSAR' : 'INICIAR'}
                        </button>
                        <button id="pomodoro-reset-button" class="btn-desestres bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded-xl hover:bg-gray-400">
                            REINICIAR
                        </button>
                    </div>
                </div>
            `;
        }

        function initializePomodoro() {
            document.getElementById('pomodoro-toggle-button').addEventListener('click', togglePomodoro);
            document.getElementById('pomodoro-reset-button').addEventListener('click', resetPomodoro);
            
            // Si estaba corriendo en el estado global, reiniciar el intervalo
            if (pomodoroState.isRunning) {
                startTimer();
            }
        }

        function updateDisplay() {
            const minutes = String(Math.floor(pomodoroState.remaining / 60)).padStart(2, '0');
            const seconds = String(pomodoroState.remaining % 60).padStart(2, '0');
            const status = pomodoroState.isBreak ? 'DESCANSANDO' : 'TRABAJO';

            const timerElement = document.getElementById('focus-timer');
            const statusElement = document.getElementById('focus-timer-status');
            const toggleButton = document.getElementById('pomodoro-toggle-button');
            
            if (timerElement) timerElement.textContent = `${minutes}:${seconds}`;
            if (statusElement) {
                statusElement.textContent = status;
                statusElement.classList.remove('bg-orange-100', 'text-orange-600', 'bg-teal-100', 'text-teal-600');
                statusElement.classList.add(pomodoroState.isBreak ? 'bg-orange-100' : 'bg-teal-100');
                statusElement.classList.add(pomodoroState.isBreak ? 'text-orange-600' : 'text-teal-600');
            }
            if (toggleButton) toggleButton.textContent = pomodoroState.isRunning ? 'PAUSAR' : 'INICIAR';
            if (timerElement) {
                if (pomodoroState.isRunning) {
                    timerElement.classList.add('timer-running');
                } else {
                    timerElement.classList.remove('timer-running');
                }
            }
        }

        function startTimer() {
            if (window.timerInterval) clearInterval(window.timerInterval);
            
            window.timerInterval = setInterval(() => {
                if (pomodoroState.remaining > 0) {
                    pomodoroState.remaining--;
                } else {
                    // Tiempo terminado, cambiar de modo
                    clearInterval(window.timerInterval);
                    window.timerInterval = null;
                    
                    // Notificaci√≥n (usando un simple modal de texto)
                    const message = pomodoroState.isBreak ? "¬°Tiempo de trabajo!" : "¬°Tiempo de descanso!";
                    alertMessage(message);

                    pomodoroState.isBreak = !pomodoroState.isBreak;
                    pomodoroState.duration = pomodoroState.isBreak ? 5 * 60 : 25 * 60;
                    pomodoroState.remaining = pomodoroState.duration;
                    pomodoroState.isRunning = false;
                }
                updateDisplay();
            }, 1000);
            pomodoroState.isRunning = true;
            updateDisplay();
        }

        function togglePomodoro() {
            if (pomodoroState.isRunning) {
                clearInterval(window.timerInterval);
                window.timerInterval = null;
                pomodoroState.isRunning = false;
            } else {
                startTimer();
            }
            updateDisplay();
        }

        function resetPomodoro() {
            clearInterval(window.timerInterval);
            window.timerInterval = null;
            pomodoroState.isBreak = false;
            pomodoroState.duration = 25 * 60;
            pomodoroState.remaining = 25 * 60;
            pomodoroState.isRunning = false;
            updateDisplay();
        }

        // =======================================================
        // 6. BORRADO DE PREOCUPACIONES (Focus Eraser)
        // =======================================================
        let worryState = {
            worries: ['Tengo que terminar el informe', '¬øQu√© cocinar para cenar?', 'Revisar mi correo', 'La llamada de ma√±ana', 'El tr√°fico', 'Pagar las cuentas'],
        };

        function renderPreocupaciones() {
            const worryHtml = worryState.worries.map((worry, index) => 
                `<span class="worry-item" data-index="${index}">${worry}</span>`
            ).join('');

            return `
                <div id="preocupaciones-activity" class="container-box max-w-2xl mx-auto text-center">
                    <h2 class="text-2xl font-bold mb-4 text-red-600">Borrado de Preocupaciones</h2>
                    <p class="text-gray-500 mb-4">Escribe tus preocupaciones. Luego, haz clic en cada una para borrarlas de tu mente.</p>
                    
                    <div class="flex flex-col sm:flex-row gap-2 mb-4">
                        <input type="text" id="worry-input" placeholder="Escribe tu preocupaci√≥n aqu√≠..." class="flex-grow p-2 border border-gray-300 rounded-lg focus:ring-red-500 focus:border-red-500">
                        <button id="worry-add-button" class="btn-desestres bg-red-500 text-white font-bold py-2 px-4 rounded-xl hover:bg-red-600">
                            A√±adir
                        </button>
                    </div>

                    <div id="worry-board-container" class="min-h-[200px] border border-dashed border-red-300 rounded-xl p-4 bg-red-50 overflow-y-auto">
                        <div id="worry-board">${worryHtml}</div>
                    </div>
                    <button id="worry-reset-button" class="btn-desestres bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-xl hover:bg-gray-400 mt-4">
                        Limpiar Tablero
                    </button>
                </div>
            `;
        }

        function initializePreocupaciones() {
            document.getElementById('worry-add-button').addEventListener('click', addWorry);
            document.getElementById('worry-board').addEventListener('click', eraseWorry);
            document.getElementById('worry-reset-button').addEventListener('click', renderWorryBoard);
            document.getElementById('worry-input').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addWorry();
            });
            renderWorryBoard();
        }

        function addWorry() {
            const input = document.getElementById('worry-input');
            const newWorry = input.value.trim();
            if (newWorry) {
                worryState.worries.push(newWorry);
                input.value = '';
                renderWorryBoard();
            }
        }

        function eraseWorry(e) {
            if (e.target.classList.contains('worry-item')) {
                const item = e.target;
                item.classList.add('erased');
                // Eliminar del array despu√©s de la animaci√≥n
                setTimeout(() => {
                    const indexToRemove = worryState.worries.indexOf(item.textContent);
                    if (indexToRemove > -1) {
                        worryState.worries.splice(indexToRemove, 1);
                    }
                    renderWorryBoard();
                }, 300); 
            }
        }
        
        function renderWorryBoard() {
            const board = document.getElementById('worry-board');
            if (!board) return;
            
            const worryHtml = worryState.worries.map((worry, index) => 
                `<span class="worry-item" data-index="${index}">${worry}</span>`
            ).join('');
            
            board.innerHTML = worryHtml || `<p class="text-gray-400 mt-8">¬°Tablero limpio! Escribe una preocupaci√≥n para empezar.</p>`;
        }
        
        // =======================================================
        // 7. DIARIO R√ÅPIDO DE GRATITUD
        // =======================================================

        function renderGratitud() {
            // Usamos localStorage para una persistencia simple entre sesiones
            const gratitudeList = JSON.parse(localStorage.getItem('gratitudeList') || '[]');
            const listHtml = gratitudeList.map((item, index) => `
                <li class="p-3 bg-sky-50 rounded-lg mb-2 flex justify-between items-center text-left">
                    <span class="text-gray-800">${item.text}</span>
                    <span class="text-sm text-gray-500 ml-4">${item.date}</span>
                </li>
            `).join('');

            return `
                <div id="gratitud-activity" class="container-box max-w-xl mx-auto text-center">
                    <h2 class="text-2xl font-bold mb-4 text-yellow-600">Diario R√°pido de Gratitud</h2>
                    <p class="text-gray-500 mb-4">Escribe 3 cosas por las que est√°s agradecido para mejorar tu estado de √°nimo.</p>
                    
                    <div class="flex flex-col gap-2 mb-4">
                        <textarea id="gratitude-input" rows="3" placeholder="Hoy estoy agradecido por..." class="p-3 border border-gray-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500"></textarea>
                        <button id="gratitude-save-button" class="btn-desestres bg-yellow-500 text-white font-bold py-2 px-4 rounded-xl hover:bg-yellow-600">
                            Guardar Agradecimiento
                        </button>
                    </div>

                    <h3 class="text-xl font-semibold mt-6 mb-3 text-gray-700">Agradecimientos Anteriores</h3>
                    <ul id="gratitude-list-container" class="list-none p-0 text-left">
                        ${listHtml || '<p class="text-gray-400">A√∫n no hay entradas de gratitud.</p>'}
                    </ul>
                </div>
            `;
        }

        function initializeGratitud() {
            document.getElementById('gratitude-save-button').addEventListener('click', saveGratitude);
        }

        function saveGratitude() {
            const input = document.getElementById('gratitude-input');
            const newText = input.value.trim();
            if (newText) {
                const gratitudeList = JSON.parse(localStorage.getItem('gratitudeList') || '[]');
                const date = new Date().toLocaleDateString('es-ES', { month: 'short', day: 'numeric' });
                
                gratitudeList.unshift({ text: newText, date: date });
                
                // Limitar a 10 entradas para mantenerlo r√°pido y simple
                if (gratitudeList.length > 10) {
                    gratitudeList.pop(); 
                }

                localStorage.setItem('gratitudeList', JSON.stringify(gratitudeList));
                input.value = '';
                
                // Volver a renderizar la actividad para mostrar la nueva lista
                switchActivity('gratitud');
            }
        }
        
        // =======================================================
        // 8. VISUALIZADOR DE ONDAS (Wave Visualizer)
        // =======================================================
        let waveState = {
            canvas: null,
            ctx: null,
            width: 0,
            height: 0,
            amplitude: 50,
            frequency: 0.01,
            speed: 0.05,
            offset: 0,
            color: '#6366f1' // Indigo-500
        };

        function renderOndas() {
            return `
                <div id="ondas-activity" class="container-box max-w-4xl mx-auto text-center">
                    <h2 class="text-2xl font-bold mb-4 text-indigo-600">Visualizador de Ondas Suaves</h2>
                    <p class="text-gray-500 mb-4">Observa el movimiento r√≠tmico para inducir un estado de calma.</p>
                    
                    <div class="flex flex-wrap justify-center gap-4 mb-4 p-3 bg-sky-50 rounded-lg">
                        <label class="text-sm font-medium text-gray-700 flex items-center">
                            Velocidad: 
                            <input type="range" id="wave-speed-slider" min="0" max="0.1" step="0.005" value="0.05" class="ml-2 w-32 cursor-pointer">
                        </label>
                        <label class="text-sm font-medium text-gray-700 flex items-center">
                            Amplitud: 
                            <input type="range" id="wave-amplitude-slider" min="10" max="100" value="50" class="ml-2 w-32 cursor-pointer">
                        </label>
                    </div>

                    <canvas id="wave-canvas"></canvas>
                </div>
            `;
        }

        function initializeOndas() {
            waveState.canvas = document.getElementById('wave-canvas');
            waveState.ctx = waveState.canvas.getContext('2d');

            function resizeCanvasOndas() {
                const container = document.getElementById('ondas-activity');
                if (container) {
                    waveState.width = container.clientWidth - 32;
                    waveState.height = Math.min(300, container.clientWidth * 0.5);
                    waveState.canvas.width = waveState.width;
                    waveState.canvas.height = waveState.height;
                }
            }
            window.addEventListener('resize', resizeCanvasOndas);
            resizeCanvasOndas(); 

            document.getElementById('wave-speed-slider').addEventListener('input', (e) => {
                waveState.speed = parseFloat(e.target.value);
            });
            document.getElementById('wave-amplitude-slider').addEventListener('input', (e) => {
                waveState.amplitude = parseInt(e.target.value);
            });

            animateOndas();
        }

        function drawWave() {
            const { ctx, width, height, amplitude, frequency, offset, color } = waveState;
            ctx.clearRect(0, 0, width, height);
            
            ctx.beginPath();
            ctx.moveTo(0, height / 2);
            
            for (let x = 0; x < width; x++) {
                // Funci√≥n de onda Senoidal + Cosenoidal para una forma m√°s interesante
                const y = height / 2 + 
                          amplitude * Math.sin(x * frequency + offset) * 0.6 + 
                          (amplitude / 3) * Math.cos(x * frequency * 2 + offset * 1.5);
                ctx.lineTo(x, y);
            }
            
            ctx.strokeStyle = color;
            ctx.lineWidth = 3;
            ctx.stroke();
            
            waveState.offset += waveState.speed; // Avanza el offset para el movimiento
        }

        function animateOndas() {
            drawWave();
            window.waveAnimationFrame = requestAnimationFrame(animateOndas);
        }

        // =======================================================
        // 9. JUEGO DE MEMORIA (Concentraci√≥n)
        // =======================================================
        const MEMORY_ICONS = ['‚≠ê', 'üíñ', 'üåä', 'üå≤', 'üåô', '‚òÄÔ∏è', 'üßò', 'üéß'];
        let memoryState = {
            board: [],
            size: 16,
            flippedCards: [],
            matchesFound: 0,
            canFlip: true
        };

        function renderMemoria() {
            return `
                <div id="memoria-activity" class="container-box max-w-xl mx-auto text-center">
                    <h2 class="text-2xl font-bold mb-4 text-purple-600">Juego de Memoria (Concentraci√≥n)</h2>
                    <p class="text-gray-500 mb-4">Encuentra los pares. Enf√≥cate en el momento para ejercitar tu mente.</p>
                    
                    <div id="memory-board" class="grid grid-cols-4 gap-4 p-4 bg-purple-50 rounded-xl">
                        <!-- Tarjetas inyectadas aqu√≠ -->
                    </div>
                    
                    <p id="memory-message" class="text-lg font-semibold text-purple-600 mt-4 h-6">Encuentra los pares...</p>
                    
                    <button id="memory-reset-button" class="btn-desestres bg-indigo-500 text-white font-bold py-2 px-4 rounded-xl hover:bg-indigo-600 mt-4">
                        Reiniciar Juego
                    </button>
                </div>
                <style>
                    .memory-card {
                        background-color: #a78bfa; /* Violet-400 */
                        width: 100%;
                        padding-bottom: 100%;
                        border-radius: 0.75rem;
                        cursor: pointer;
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        font-size: 2.5rem;
                        color: white;
                        transition: transform 0.3s ease-in-out;
                        transform: rotateY(0deg);
                        position: relative;
                        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                    }
                    .memory-card.flipped, .memory-card.matched {
                        background-color: #ede9fe; /* Violet-100 */
                        transform: rotateY(180deg);
                        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                    }
                    .memory-card.matched {
                        background-color: #34d399; /* Emerald-400 */
                        cursor: default;
                    }
                    .card-inner {
                        position: absolute;
                        width: 100%;
                        height: 100%;
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        backface-visibility: hidden;
                        transform-style: preserve-3d;
                    }
                    .card-back {
                        transform: rotateY(180deg);
                        color: #1e293b;
                    }
                    .card-front {
                        transform: rotateY(0deg);
                        color: white;
                    }
                </style>
            `;
        }

        function initializeMemoria() {
            createMemoryBoard();
            document.getElementById('memory-reset-button').addEventListener('click', createMemoryBoard);
        }
        
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function createMemoryBoard() {
            memoryState.board = shuffleArray([...MEMORY_ICONS, ...MEMORY_ICONS]);
            memoryState.flippedCards = [];
            memoryState.matchesFound = 0;
            memoryState.canFlip = true;
            
            const boardElement = document.getElementById('memory-board');
            const messageElement = document.getElementById('memory-message');
            if (!boardElement) return;

            boardElement.innerHTML = memoryState.board.map((icon, index) => `
                <div class="memory-card" data-index="${index}" onclick="flipCard(this)">
                    <div class="card-inner card-front">?</div>
                    <div class="card-inner card-back">${icon}</div>
                </div>
            `).join('');

            messageElement.textContent = "Encuentra los pares...";
        }

        window.flipCard = function(card) {
            if (!memoryState.canFlip || card.classList.contains('flipped') || card.classList.contains('matched')) {
                return;
            }

            card.classList.add('flipped');
            memoryState.flippedCards.push(card);

            if (memoryState.flippedCards.length === 2) {
                memoryState.canFlip = false;
                const [card1, card2] = memoryState.flippedCards;
                const icon1 = memoryState.board[parseInt(card1.dataset.index)];
                const icon2 = memoryState.board[parseInt(card2.dataset.index)];

                if (icon1 === icon2) {
                    // Match found
                    setTimeout(() => {
                        card1.classList.add('matched');
                        card2.classList.add('matched');
                        card1.classList.remove('flipped');
                        card2.classList.remove('flipped');
                        memoryState.matchesFound++;
                        memoryState.flippedCards = [];
                        memoryState.canFlip = true;

                        if (memoryState.matchesFound === memoryState.size / 2) {
                            document.getElementById('memory-message').textContent = "¬°Felicidades! Lo lograste.";
                        }
                    }, 500);
                } else {
                    // No match
                    setTimeout(() => {
                        card1.classList.remove('flipped');
                        card2.classList.remove('flipped');
                        memoryState.flippedCards = [];
                        memoryState.canFlip = true;
                    }, 1000);
                }
            }
        }
        
        // =======================================================
        // 10. DIBUJO DE SIMETR√çA
        // =======================================================
        let symmetryState = {
            isDrawing: false,
            lastX: 0,
            lastY: 0,
            color: '#059669', // Emerald-600
            lineWidth: 5,
            canvas: null,
            ctx: null
        };

        function renderSimetria() {
            return `
                <div id="simetria-activity" class="container-box max-w-4xl mx-auto text-center">
                    <h2 class="text-2xl font-bold mb-4 text-emerald-600">Dibujo de Simetr√≠a</h2>
                    <p class="text-gray-500 mb-4">Dibuja en un lado y se reflejar√° en el otro. Un ejercicio calmante de concentraci√≥n.</p>
                    
                    <div class="flex flex-wrap justify-center gap-4 mb-4 p-3 bg-sky-50 rounded-lg">
                        <label class="text-sm font-medium text-gray-700 flex items-center">
                            Color: 
                            <input type="color" id="symmetry-color-picker" value="#059669" class="ml-2 w-8 h-8 rounded-full border-2 border-gray-400 cursor-pointer">
                        </label>
                        <label class="text-sm font-medium text-gray-700 flex items-center">
                            Grosor: 
                            <input type="range" id="symmetry-thickness-slider" min="1" max="20" value="5" class="ml-2 w-32 cursor-pointer">
                            <span id="symmetry-thickness-value" class="ml-2 text-gray-700">5</span>
                        </label>
                        <button id="symmetry-clear-button" class="btn-desestres bg-red-500 text-white font-bold py-2 px-4 rounded-xl hover:bg-red-600">
                            Limpiar
                        </button>
                    </div>

                    <canvas id="symmetry-canvas"></canvas>
                </div>
            `;
        }

        function initializeSimetria() {
            symmetryState.canvas = document.getElementById('symmetry-canvas');
            symmetryState.ctx = symmetryState.canvas.getContext('2d');

            function resizeCanvasSymmetry() {
                const container = document.getElementById('simetria-activity');
                if (container) {
                    symmetryState.canvas.width = container.clientWidth - 32;
                    symmetryState.canvas.height = Math.min(400, container.clientWidth * 0.75);
                    clearCanvasSymmetry();
                    drawCenterLine();
                }
            }
            window.addEventListener('resize', resizeCanvasSymmetry);
            resizeCanvasSymmetry();

            // Configuraci√≥n inicial
            symmetryState.ctx.lineCap = 'round';
            symmetryState.ctx.lineJoin = 'round';
            symmetryState.ctx.lineWidth = symmetryState.lineWidth;
            symmetryState.ctx.strokeStyle = symmetryState.color;

            // Event listeners (solo para el lado izquierdo del canvas)
            symmetryState.canvas.addEventListener('mousedown', startDrawingSymmetry);
            symmetryState.canvas.addEventListener('mousemove', drawSymmetry);
            symmetryState.canvas.addEventListener('mouseup', stopDrawingSymmetry);
            symmetryState.canvas.addEventListener('mouseout', stopDrawingSymmetry);
            
            symmetryState.canvas.addEventListener('touchstart', startDrawingSymmetry);
            symmetryState.canvas.addEventListener('touchmove', drawSymmetry);
            symmetryState.canvas.addEventListener('touchend', stopDrawingSymmetry);

            // Controles
            document.getElementById('symmetry-color-picker').addEventListener('input', (e) => {
                symmetryState.color = e.target.value;
                symmetryState.ctx.strokeStyle = symmetryState.color;
            });
            const thicknessSlider = document.getElementById('symmetry-thickness-slider');
            const thicknessValue = document.getElementById('symmetry-thickness-value');
            thicknessSlider.addEventListener('input', (e) => {
                symmetryState.lineWidth = parseInt(e.target.value);
                symmetryState.ctx.lineWidth = symmetryState.lineWidth;
                thicknessValue.textContent = symmetryState.lineWidth;
            });
            document.getElementById('symmetry-clear-button').addEventListener('click', clearCanvasSymmetry);
        }

        function drawCenterLine() {
            const ctx = symmetryState.ctx;
            const center = symmetryState.canvas.width / 2;
            
            ctx.beginPath();
            ctx.strokeStyle = '#94a3b8'; // Slate-400
            ctx.lineWidth = 1;
            ctx.setLineDash([5, 5]); // L√≠nea punteada
            ctx.moveTo(center, 0);
            ctx.lineTo(center, symmetryState.canvas.height);
            ctx.stroke();
            ctx.setLineDash([]); // Restablecer a l√≠nea continua
        }

        function getCoordsSymmetry(e) {
            const rect = symmetryState.canvas.getBoundingClientRect();
            let clientX, clientY;

            if (e.touches && e.touches.length > 0) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }

            return {
                x: clientX - rect.left,
                y: clientY - rect.top
            };
        }

        function startDrawingSymmetry(e) {
            e.preventDefault();
            const coords = getCoordsSymmetry(e);
            if (coords.x > symmetryState.canvas.width / 2) return; // Solo dibujar en el lado izquierdo
            
            symmetryState.isDrawing = true;
            [symmetryState.lastX, symmetryState.lastY] = [coords.x, coords.y];
            
            // Dibujar punto inicial
            drawSymmetryLine(coords.x, coords.y, coords.x, coords.y);
        }

        function drawSymmetry(e) {
            e.preventDefault(); 
            if (!symmetryState.isDrawing) return;
            
            const coords = getCoordsSymmetry(e);
            if (coords.x > symmetryState.canvas.width / 2) {
                stopDrawingSymmetry();
                return;
            }

            drawSymmetryLine(symmetryState.lastX, symmetryState.lastY, coords.x, coords.y);
            
            [symmetryState.lastX, symmetryState.lastY] = [coords.x, coords.y];
        }

        function drawSymmetryLine(x1, y1, x2, y2) {
            const ctx = symmetryState.ctx;
            const center = symmetryState.canvas.width / 2;
            
            ctx.strokeStyle = symmetryState.color;
            ctx.lineWidth = symmetryState.lineWidth;

            // 1. L√≠nea original (izquierda)
            ctx.beginPath();
            ctx.moveTo(x1, y1);
            ctx.lineTo(x2, y2);
            ctx.stroke();

            // 2. L√≠nea sim√©trica (derecha)
            const rx1 = center + (center - x1);
            const rx2 = center + (center - x2);
            
            ctx.beginPath();
            ctx.moveTo(rx1, y1);
            ctx.lineTo(rx2, y2);
            ctx.stroke();
        }

        function stopDrawingSymmetry() {
            symmetryState.isDrawing = false;
        }

        function clearCanvasSymmetry() {
            const ctx = symmetryState.ctx;
            ctx.clearRect(0, 0, symmetryState.canvas.width, symmetryState.canvas.height);
            drawCenterLine();
        }

        // =======================================================
        // Sistema de Mensajes de Alerta (No-alert)
        // =======================================================
        // Usado para notificaciones como el final del Pomodoro
        function alertMessage(message) {
            // Reemplazar con una implementaci√≥n real de modal/toast si fuera necesario
            console.log("ALERTA:", message); 
            const header = document.querySelector('header');
            const alertDiv = document.createElement('div');
            alertDiv.className = 'fixed top-4 right-4 bg-indigo-500 text-white p-4 rounded-lg shadow-lg z-50 transition-opacity duration-500';
            alertDiv.textContent = message;
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                alertDiv.style.opacity = '0';
                setTimeout(() => alertDiv.remove(), 500);
            }, 3000);
        }
        
        // =======================================================
        // Inicializaci√≥n
        // =======================================================
        window.onload = () => switchActivity(currentActivity);
    </script>
</body>
</html>
